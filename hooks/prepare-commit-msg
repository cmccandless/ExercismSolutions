#!/c/Python36/python

import sys
import hook_utils as hut


def main(commit_file, type=None, sha1_hash=None):
    changes, ret = hut.exec('git', 'diff', '--cached', '--name-status')
    changes = changes.split('\n')
    if ret != 0:
        hut.abort('error {} occurred'.format(ret), label='git-diff')
    changed_tracks = set()
    for change in changes:
        if change == '':
            continue
        change_type, *fileparts = change.split()
        filename = ' '.join(fileparts).strip()
        if change_type == 'D' or '/' not in filename:
            continue
        track, exercise, *_ = filename.split('/')
        changed_tracks.add(track)

    commit_msg = 'new solutions to {} exercises\n'
    commit_msg = commit_msg.format(', '.join(changed_tracks))

    with open(commit_file, 'r') as f:
        commit_msg += f.read()

    with open(commit_file, 'w') as f:
        f.write(commit_msg)


if __name__ == '__main__':
    main(*sys.argv[1:])
